<!-- index.html (snippet) -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Smart AI Assistant</title>
</head>
<body>
  <div id="app">
    <div id="locked" style="display:none;">
      <h2>Unauthorized copy</h2>
      <p>Your copy is disabled. Enter license to continue:</p>
      <input id="licenseInput" placeholder="Enter license key"/>
      <button id="submitLicense">Submit</button>
    </div>

    <div id="mainApp" style="display:none;">
      <!-- your app UI here -->
      <h1>Welcome to Smart AI Assistant</h1>
      <div id="content">Loading features...</div>
    </div>
  </div>

  <script>
  // ===== configuration =====
  const LICENSE_VALIDATE_URL = "https://your-server.com/check-license"; // server endpoint
  const APP_INIT_TIMEOUT_MS = 7000; // how long to wait for server before using fallback

  // ===== utility: self-destruct / disable =====
  function disableApp(reason) {
    console.error("App disabled:", reason);
    // Replace core functions with no-ops
    window.runApp = function() { throw new Error("This copy is disabled."); };
    // hide main UI and show locked UI
    document.getElementById('mainApp').style.display = 'none';
    document.getElementById('locked').style.display = 'block';
    // optionally wipe sensitive vars
    // (Note: can't truly erase from user's memory, but overwrite)
    window.__SECRET__ = null;
  }

  // ===== show app =====
  function showApp() {
    document.getElementById('locked').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
  }

  // ===== local fallback check (simple example) =====
  // This is NOT bulletproof. Use signed tokens if you need offline capability.
  function localKeyCheck(key) {
    // Example: simple hash check (client-side); attacker can reverse engineer.
    // Better: store a signed token generated by server (HMAC) with expiry and verify signature on client.
    if (!key) return false;
    // simple demonstration: allow keys that start with "OFFLINE-"
    return key.startsWith("OFFLINE-");
  }

  // ===== main license validation flow =====
  async function validateAndStart() {
    const storedKey = localStorage.getItem('license_key') || '';
    if (!storedKey) {
      // no key -> locked UI
      disableApp("No license key stored");
      return;
    }

    let serverValidated = false;
    let serverResponded = false;

    // start server validation, but don't block UI forever
    const timeout = new Promise((resolve) => setTimeout(() => resolve({timeout: true}), APP_INIT_TIMEOUT_MS));

    try {
      const validation = await Promise.race([
        fetch(`${LICENSE_VALIDATE_URL}?key=${encodeURIComponent(storedKey)}`, {method:'GET', cache: 'no-store'})
          .then(r => r.json())
          .catch(err => ({error: true, err}))
        , timeout
      ]);

      if (validation && validation.timeout) {
        serverResponded = false;
      } else {
        serverResponded = true;
        if (validation && validation.valid) {
          serverValidated = true;
        } else {
          serverValidated = false;
        }
      }
    } catch (e) {
      serverResponded = false;
      serverValidated = false;
    }

    // Decision logic:
    // - If server validated => run app
    // - Else if server unreachable but localKeyCheck passes => run app (offline mode)
    // - Else disable app
    if (serverValidated) {
      console.log("License validated by server. Starting app...");
      startApp(); // your initialiser
    } else {
      if (!serverResponded && localKeyCheck(storedKey)) {
        console.log("Server not reachable, but local offline key passed. Starting offline mode...");
        startApp({offline:true});
      } else {
        disableApp("License not valid or server check failed");
      }
    }
  }

  // ===== user interaction for entering license =====
  document.getElementById('submitLicense').addEventListener('click', () => {
    const val = document.getElementById('licenseInput').value.trim();
    if (!val) return;
    localStorage.setItem('license_key', val);
    // try to validate immediately
    validateAndStart();
  });

  // ===== your app entry point (wrap your existing code here) =====
  function startApp(opts={}) {
    showApp();
    // Example public function that the rest of your system will call
    window.runApp = function() {
      if (opts.offline) {
        document.getElementById('content').innerText = 'Running in OFFLINE mode (some features disabled)';
      } else {
        document.getElementById('content').innerText = 'App running (all features enabled)';
      }
      // ... initialize the rest of your app here ...
    };

    // Immediately run
    try { window.runApp(); } catch (e) { console.error(e); }
  }

  // ===== On load, check license =====
  (function init() {
    // If there's a stored key, attempt validation automatically
    const storedKey = localStorage.getItem('license_key');
    if (storedKey) {
      validateAndStart();
    } else {
      // show locked UI so user can paste license
      disableApp("No key found");
    }
  })();
  </script>
</body>
</html>
